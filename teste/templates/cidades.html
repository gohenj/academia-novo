{% extends "layout.html" %}

{% block content %}
    <h2>Gerenciar Cidades</h2>
    
    <div class="card mb-4">
        <div class="card-header">Adicionar Nova Cidade</div>
        <div class="card-body">
            <!-- novalidate impede a validação HTML padrão, para usarmos a nossa do Flask -->
            <form action="{{ url_for('cidades') }}" method="POST" novalidate>
                <!-- hidden_tag() é ESSENCIAL para a segurança do formulário (CSRF) -->
                {{ form.hidden_tag() }}
                <div class="row g-3 align-items-end">
                    <div class="col-md-2">
                        <!-- Renderiza o label (rótulo) do campo -->
                        {{ form.cod.label(class="form-label") }}
                        <!-- Renderiza o campo de input, já com as classes do Bootstrap -->
                        {{ form.cod(class="form-control", placeholder="Código") }}
                        <!-- Este loop mostra os erros de validação APENAS para este campo -->
                        {% for error in form.cod.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    <div class="col-md-6">
                        {{ form.desc.label(class="form-label") }}
                        {{ form.desc(class="form-control", placeholder="Descrição (Nome)") }}
                        {% for error in form.desc.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    <div class="col-md-2">
                        {{ form.uf.label(class="form-label") }}
                        {{ form.uf(class="form-control", placeholder="UF") }}
                        {% for error in form.uf.errors %}
                            <div class="text-danger small mt-1">{{ error }}</div>
                        {% endfor %}
                    </div>
                    <div class="col-md-2">
                        <!-- Renderiza o botão de submit -->
                        {{ form.submit(class="btn btn-primary w-100") }}
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- A tabela de exibição não muda, continua a mesma -->
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Código</th>
                <th>Descrição</th>
                <th>Estado</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            {% for cidade in cidades %}
            <tr>
                <td>{{ cidade[0] }}</td>
                <td>{{ cidade[1] }}</td>
                <td>{{ cidade[2] | upper }}</td>
                <td>
                    <a href="{{ url_for('excluir_cidade', cod=cidade[0]) }}" class="btn btn-danger btn-sm"
                       onclick="return confirm('Tem certeza que deseja excluir?');">Excluir</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="text-center">Nenhuma cidade cadastrada.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

